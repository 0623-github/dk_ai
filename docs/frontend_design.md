# AI 聊天系统前端设计文档

---

## 1. 概述

### 1.1 项目背景

本文档描述 AI 聊天系统的前端设计方案。该系统提供基于 Web 的聊天界面，支持多会话管理、实时消息交互等功能。前端通过 HTTP API 与后端 Ollama AI 服务通信，实现智能对话功能。

### 1.2 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| HTML5 | - | 页面结构 |
| CSS3 | - | 样式设计 |
| JavaScript (ES6+) | - | 交互逻辑 |
| Fetch API | - | 网络请求 |
| LocalStorage | - | 本地存储 |

### 1.3 设计目标

- 提供直观、友好的聊天用户界面
- 支持多会话管理（创建、切换、删除）
- 实现实时消息交互和加载状态展示
- 消息历史本地持久化
- 响应式设计，适配多端设备

---

## 2. 界面设计

### 2.1 整体布局

采用**侧边栏 + 主聊天区域**的双栏布局：

```
┌─────────────────────────────────────────────────────────────────┐
│                         页面布局                                  │
├──────────────┬──────────────────────────────────────────────────┤
│              │  聊天标题栏                                       │
│   侧边栏      │  ┌──────────────────────────────────────────┐  │
│              │  │                                          │  │
│  - 新建会话   │  │           消息列表区域                     │  │
│  - 会话列表   │  │                                          │  │
│  - 连接状态   │  │                                          │  │
│              │  │                                          │  │
│              │  └──────────────────────────────────────────┘  │
│              │  输入区域                                        │
└──────────────┴──────────────────────────────────────────────────┘
```

### 2.2 侧边栏设计

**宽度**：280px（固定）

**包含元素**：
1. **头部**：应用标题 + 新建会话按钮
2. **会话列表**：可滚动的会话项列表
3. **底部状态栏**：显示后端连接状态

**会话列表项结构**：
```
┌─────────────────────────────────────────┐
│ [图标] 会话标题                    [删除] │
│        时间                              │
└─────────────────────────────────────────┘
```

### 2.3 主聊天区域

**包含元素**：
1. **标题栏**：当前会话标题 + 创建时间 + 清空按钮
2. **消息容器**：可滚动的消息列表
3. **输入区域**：文本输入框 + 发送按钮

### 2.4 视觉设计

#### 色彩方案

| 用途 | 颜色 | Hex |
|------|------|-----|
| 主色调 | 紫蓝渐变 | #667eea → #764ba2 |
| 主色悬停 | 深紫色 | #5a67d8 |
| 背景色 | 浅灰蓝 | #f7f8fc |
| 侧边栏背景 | 白色 | #ffffff |
| 用户消息 | 紫色 | #667eea |
| 助手消息 | 白色 | #ffffff |
| 边框色 | 浅灰 | #e5e7eb |
| 文字主色 | 深灰 | #1f2937 |
| 文字次要 | 中灰 | #6b7280 |

#### 字体

- 主字体：-apple-system, BlinkMacSystemFont, 'Segoe UI', PingFang SC, Hiragino Sans GB, Microsoft YaHei
- 正文字号：0.9375rem (15px)
- 标题字号：1.125rem (18px)
- 辅助字号：0.75rem (12px)

#### 间距系统

- 基础间距：4px
- 小间距：8px
- 中间距：12px / 16px
- 大间距：24px
- 边距：20px / 24px

#### 圆角

- 小圆角：6px
- 中圆角：10px
- 大圆角：16px

#### 阴影

- 小阴影：0 1px 2px rgba(0, 0, 0, 0.05)
- 中阴影：0 4px 6px -1px rgba(0, 0, 0, 0.1)
- 大阴影：0 10px 15px -3px rgba(0, 0, 0, 0.1)

---

## 3. 功能设计

### 3.1 核心功能

#### 3.1.1 会话管理

| 功能 | 描述 |
|------|------|
| 创建会话 | 点击侧边栏顶部 + 按钮创建新会话 |
| 切换会话 | 点击会话列表项切换当前会话 |
| 删除会话 | 点击会话项右侧删除按钮删除会话 |
| 清空会话 | 点击标题栏清空按钮清空当前会话消息 |

#### 3.1.2 消息交互

| 功能 | 描述 |
|------|------|
| 发送消息 | 点击发送按钮 或 按 Enter 键发送 |
| 换行输入 | 按 Shift + Enter 换行 |
| 自动调整 | 输入框高度随内容自动调整 |
| 字符统计 | 实时显示输入字符数 |

#### 3.1.3 状态展示

| 功能 | 描述 |
|------|------|
| 加载状态 | 发送消息时显示加载动画 |
| 连接状态 | 侧边栏底部显示后端连接状态 |
| Toast 提示 | 操作成功后显示提示消息 |

#### 3.1.4 欢迎界面

首次进入或会话无消息时显示欢迎界面，包含：
- 应用图标
- 欢迎标题
- 引导文案
- 快捷入口按钮（介绍自己、询问天气、讲个笑话）

### 3.2 用户交互流程

```
用户进入页面
    │
    ▼
加载本地会话列表
    │
    ▼
显示会话列表 & 进入欢迎页
    │
    ├────────────────────────────┐
    ▼                            ▼
发送消息                    选择快捷问题
    │                            │
    ▼                            ▼
显示用户消息              自动填充输入框
    │                            │
    ▼                            ▼
显示加载动画              ▼
    │                            │
    ▼                            ▼
调用后端 API ──────────► 发送消息
    │                            │
    ▼                            ▼
接收 AI 响应              显示助手消息
    │
    ▼
显示助手消息
    │
    ▼
保存到本地存储
```

### 3.3 数据结构

#### 会话数据

```javascript
{
  id: "session_123456789_abc123",
  title: "新会话",
  messages: [
    {
      role: "user" | "assistant",
      content: "消息内容",
      timestamp: 1699999999999
    }
  ],
  createdAt: 1699999999999,
  updatedAt: 1699999999999
}
```

#### 本地存储

- **键名**：`chat_sessions`
- **存储格式**：JSON 字符串化的会话数组

---

## 4. API 设计

### 4.1 请求格式

#### 聊天接口

**请求**：POST /chat

```javascript
{
  session_id: "会话ID（可选）",
  message: "用户消息内容",
  mode: "text"
}
```

**响应**：

```javascript
{
  session_id: "会话ID",
  reply: "AI 回复内容",
  timestamp: 1699999999999
}
```

### 4.2 错误处理

| 错误类型 | 处理方式 |
|----------|----------|
| 网络错误 | 显示 Toast 提示，保留消息 |
| API 错误 | 显示默认错误消息 |
| 超时 | 10秒超时，显示错误提示 |

---

## 5. 前端文件结构

```
fe/
├── index.html      # 主页面结构
├── styles.css     # 样式文件
└── script.js      # JavaScript 逻辑
```

### 5.1 模块划分（script.js）

| 模块 | 职责 |
|------|------|
| ChatApp 类 | 主应用类，管理整体状态和行为 |
| initElements | 初始化 DOM 元素引用 |
| initEventListeners | 绑定事件监听器 |
| initApp | 初始化应用 |
| 会话管理 | createNewSession, selectSession, deleteSession |
| 消息渲染 | renderSessionList, renderMessages, createMessageHTML |
| API 交互 | sendToAPI, checkConnection |
| UI 辅助 | showLoading, hideLoading, showToast, autoResize |

---

## 6. 响应式设计

### 6.1 断点

| 断点 | 宽度 | 布局变化 |
|------|------|----------|
| 桌面端 | > 768px | 双栏布局 |
| 移动端 | ≤ 768px | 侧边栏隐藏，可展开 |

### 6.2 移动端适配

- 侧边栏默认隐藏，通过滑动手势或按钮展开
- 消息最大宽度调整为 90%
- 减小内边距

---

## 7. 浏览器兼容性

| 浏览器 | 最低版本 |
|--------|----------|
| Chrome | 80+ |
| Firefox | 75+ |
| Safari | 13+ |
| Edge | 80+ |

---

## 8. 验收标准

### 8.1 功能验收

- [ ] 可以创建新会话
- [ ] 可以切换不同会话
- [ ] 可以删除会话
- [ ] 可以发送消息并收到回复
- [ ] 加载状态正确显示
- [ ] 消息历史正确保存到本地
- [ ] 刷新页面后会话历史保留

### 8.2 视觉验收

- [ ] 界面布局符合设计图
- [ ] 颜色方案符合色彩规范
- [ ] 动画效果流畅
- [ ] 响应式布局正常

### 8.3 交互验收

- [ ] Enter 键发送消息
- [ ] Shift+Enter 换行
- [ ] 输入框自动调整高度
- [ ] Toast 提示正常显示和消失

---

## 9. 后续优化建议

### 9.1 功能扩展

- 支持流式响应（SSE）
- 支持语音输入/输出
- 支持代码高亮渲染
- 支持消息复制/删除

### 9.2 性能优化

- 虚拟列表处理大量消息
- 消息懒加载
- 图片/文件上传

### 9.3 用户体验

- 快捷键支持
- 夜间模式
- 消息搜索
